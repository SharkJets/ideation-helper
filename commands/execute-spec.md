---
name: execute-spec
description: Execute action steps generated by ideation. Reads the action steps file, creates tasks, and works through them step-by-step with verification.
allowed-tools:
  - Read
  - Write
  - Edit
  - Bash
  - Glob
  - Grep
  - TaskCreate
  - TaskUpdate
  - TaskList
  - TaskGet
  - Task
  - AskUserQuestion
---

# Execute Ideation Action Steps

## Arguments: $ARGUMENTS

Execute an action steps file generated by the ideation skill.

**Parse arguments:**

- `--parallel` flag: Enable parallel execution via subagents
- Remaining argument: Action steps file path (optional)

Example: `/execute-spec --parallel` or `/execute-spec docs/ideation/foo/action-steps-phase-1.md`

## Pre-Execution

### 1. Load Action Steps

**If argument provided:** Read the action steps file directly.

**If no argument:** Auto-detect from task list:

1. Run `TaskList` to find existing phase tasks
2. Look for tasks with:
   - `status: pending` (not started)
   - Empty `blockedBy` (dependencies completed)
   - Subject starting with "Phase" or metadata containing `specFile`
3. If found, use `TaskGet` to read the task's `specFile` from metadata or description
4. Read that action steps file

**Fallback (no tasks found):** Search for action steps manually:

```
./docs/ideation/*/action-steps-phase-*.md
```

If multiple found, use `AskUserQuestion` to select one.

### 2. Context Review

**Before parsing the action steps into tasks, understand any existing context.** This prevents blind execution and ensures work follows established patterns.

**Read referenced files first:**

- If the action steps reference a **template** (e.g., "Template: ./action-steps-template-room-setup.md"), read the template file. The template contains the shared pattern; the action steps file contains the phase-specific inputs and deviations. Merge both to understand the full plan.
- If the action steps reference **"Similar to"** with descriptions, review any related prior work.

**Review the surrounding context:**

- Read any files listed in the action steps' "Deliverables" section that already exist — understand what's there before changing it
- If the action steps create new deliverables alongside existing similar work, review the existing work to match its patterns
- Check for any project notes or README that documents the approach
- Run a quick `Glob` on the directories you'll be working in, so you understand the current state

**What to look for:**

1. **Naming conventions** — How are files and deliverables named?
2. **Existing patterns** — How has similar work been done before?
3. **Quality standards** — What level of detail and finish is expected?
4. **Prior decisions** — What choices have already been made that affect this phase?

**Keep review focused.** Don't read everything — just the materials directly relevant to this phase's action steps.

### 3. Parse Action Steps Structure

Extract from the action steps file (and template if applicable):

- **Overall Approach** - High-level strategy
- **Deliverables** - What this phase produces
- **Step-by-Step Instructions** - Per-activity instructions
- **Verification Steps** - How to confirm deliverables are correct
- **Completion Checklist** - Final quality gate
- **Progress Check Strategy** - How to verify work during execution (if present)

### 4. Check or Create Tasks

**If tasks already exist** (detected in Step 1 from TaskList):

- Skip task creation
- The phase task is the parent; activity tasks may already exist
- Mark the phase task as `in_progress` and proceed to execution

**If no tasks exist** (fresh execution):

Use `TaskCreate` to create structured tasks from the action steps' Step-by-Step Instructions:

**For each activity:**

```javascript
TaskCreate({
  subject: '{Activity name from action steps}',
  description: `
## Steps
{Steps from the action steps' Step-by-Step Instructions section}

## Deliverables
{What this activity produces}

## Verification
{How to verify this activity is done correctly}
  `,
  activeForm: 'Working on {activity name}',
});
```

**After creating all activity tasks, add dependency relationships:**

```javascript
// If Activity B depends on Activity A
TaskUpdate({
  taskId: '{activityB-id}',
  addBlockedBy: ['{activityA-id}'],
});
```

**Create verification tasks (blocked by all activity tasks):**

```javascript
TaskCreate({
  subject: 'Complete final verification',
  description: 'Go through the completion checklist from the action steps',
  activeForm: 'Running final verification',
});

TaskCreate({
  subject: 'Verify done checklist',
  description: 'Review each item on the done checklist',
  activeForm: 'Verifying done checklist',
});
```

### 5. Establish Task Dependencies

Parse the action steps' Step-by-Step Instructions for activity order:

1. **Identify dependencies**: Check deliverables for overlapping outputs
2. **Create blocking relationships**:
   - Sequential activities: Activity N blocked by Activity N-1
   - Independent activities: No blockers (can run in parallel)
3. **Verification tasks**: Blocked by ALL activity tasks

### 6. Set Up Progress Checks

Before starting any activity, establish the progress check approach. This is a one-time setup.

1. **Read the Progress Check Strategy** from the action steps (if present). Identify the check method and criteria.

2. **Review existing verification resources** — even if the action steps have no explicit progress check strategy, check for:
   - Checklists or review criteria defined in the action steps
   - Reference materials mentioned for comparison
   - Success criteria from the brief
   - Prior work that can serve as a quality benchmark

3. **Establish the check approach**:
   - For steps involving Claude (research, writing, analysis): the progress check is reviewing output against the brief's success criteria
   - For steps involving the user (purchasing, physical setup): note what they should verify at each stage
   - For steps with clear deliverables: define what "done right" looks like before starting

4. **Fallback**: If no progress check strategy in the action steps AND no verification resources found, use the completion checklist as the post-execution check.

## Execution Flow

### Check Task Progress

Before starting, use `TaskList` to see current state:

- Find tasks with `status: pending` and empty `blockedBy` (ready to work)
- Skip tasks already `completed` by previous sessions

### For Each Step

1. **Claim the task**: `TaskUpdate({ taskId, status: "in_progress" })`
2. **Read** the step's details from task description
3. **Review before acting** — If modifying existing deliverables, read them first. If creating new work alongside existing similar work, review the existing work to match its approach.
4. **Work through the steps**:
   a. Follow the approach specified (if "Similar to" is referenced)
   b. Complete a meaningful portion of the work
   c. Verify the step against its criteria
   d. If verification fails: review the output, adjust, re-verify. Iterate until passing.
   e. Move to the next portion. Repeat.
5. **Complete**: `TaskUpdate({ taskId, status: "completed" })`

**If the step has no progress check:** Complete the full step, then verify against the completion checklist.

### Step Completion

After completing a step:

1. Verify the step against its criteria
2. Mark task as `completed` via `TaskUpdate`
3. Use `TaskList` to find next unblocked task
4. Report any issues before proceeding

### Handling Issues

If verification fails:

1. **Keep task as `in_progress`** (don't mark completed)
2. Report the issue clearly
3. Attempt to fix based on the problem
4. Re-verify
5. If still failing, pause and ask user

### Parallel Execution (with `--parallel` flag)

**This flag parallelizes activities *within* a single phase.** For parallelizing *across* phases, use agent teams — see the ideation handoff summary.

**Default (no flag):** Sequential execution

- Work through unblocked tasks one at a time
- Tasks auto-unblock as dependencies complete
- Simpler to follow, no conflict risk

**With `--parallel` flag:** Spawn subagents for independent activities

When `--parallel` is passed and multiple activity tasks are unblocked:

1. Check `TaskList` for all tasks with empty `blockedBy`
2. If more than one unblocked task exists:
   - Keep one task for this session
   - Spawn `Task` subagents for each additional unblocked task
   - Pass task ID and action steps context to each subagent
3. Subagents coordinate via shared `TaskList`:
   - Each claims its task with `TaskUpdate({ status: "in_progress" })`
   - Marks complete when done
   - Parent session monitors progress

## Post-Execution

### Complete Final Verification

Go through the completion checklist from the action steps:

```
- [ ] {Checklist item 1}
- [ ] {Checklist item 2}
...
```

Verify each item and report status.

### Verify Done Checklist

Review each item on the done checklist from the action steps:

```
- [ ] {Done item 1}
- [ ] {Done item 2}
...
```

Mark each as verified or report gaps.

### Completion Report

```markdown
## Phase {N} Complete

### Completed

- {List of activities completed}

### Deliverables Produced

- {List of deliverables created/completed}

### Verification Results

- {Verification item 1}: PASS/FAIL
- {Verification item 2}: PASS/FAIL

### Done Checklist

- [x] {Met criteria}
- [ ] {Unmet criteria with notes}

### Next Steps

- Review all deliverables
- Save your progress and notes
- For next phase: `/execute-spec action-steps-phase-{N+1}.md`
```

## Human-in-Loop Checkpoints

Pause and ask user when:

- A verification step fails
- Action steps contain ambiguous instructions
- A major decision is needed
- Work differs significantly from what was planned

Use `AskUserQuestion`:

```
Question: "Verification failed for {step}. How to proceed?"
Options:
- "Show details" - Display full details of the issue
- "Attempt fix" - Try to resolve based on the problem
- "Skip for now" - Continue to next step
- "Stop" - Pause execution
```

## Key Principles

1. **Understand before acting** - Review existing context and prior work before creating or modifying anything
2. **Check progress during execution, not just at the end** - Verify steps as you go
3. **Quick verification** - Check steps as you go, don't wait until everything is done
4. **Follow the action steps as written** - Don't skip or improvise beyond what's specified
5. **Stay consistent with the project's established approach** - New work should match what's already been done
6. **Verify after each step** - Don't batch all verification to the end
7. **Pause when uncertain, don't guess** - Ask the user when unclear
8. **One phase at a time** - Complete this phase fully before moving on
9. **Clear reporting** - Show what was done and what's next

## Usage

```bash
# Auto-detect next unblocked task from TaskList
/execute-spec

# Execute specific action steps
/execute-spec docs/ideation/my-project/action-steps-phase-1.md

# Parallel: spawn subagents for independent tasks
/execute-spec --parallel

# Combine: specific action steps with parallel execution
/execute-spec --parallel docs/ideation/my-project/action-steps-phase-1.md
```

**Cross-session workflow:**

```bash
# Fresh context between phases
/clear
/execute-spec         # auto-detects unblocked task
# ... execute, review ...

/clear
/execute-spec         # picks up next unblocked task
```

**For parallel execution across phases, use agent teams** — see the ideation handoff summary for a ready-to-paste team prompt.
